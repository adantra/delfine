\chapter{Formulação Matemática}
\label{ch:form_mat}

Neste trabalho, foi adotada a formulação matemática clássica proposta em \cite{Peaceman1977} para o escoamento simultâneo de duas fases imiscíveis em um meio poroso saturado. Esta abordagem vem sendo utilizada por muitos pesquisadores \citep{Ewing1983,Chavent1986,Carvalho2005,Silva2008} e tem com uma de suas principais características a manipulação da equação de conservação da massa usando a lei de Darcy de modo a formar um sistema com uma equação de pressão parabólica-elíptica e uma equação de saturação parabólica-hiperbólica \citep{Carvalho2005}, em oposição a outras formulações nas quais os campos de pressão e saturação são resolvidos simultaneamente em um sistema de \ac{EDP}s parabólicas \citep{Aziz1979}.
% [1] Describe briefly Aziz's formulation in the thesis, for comparison purposes

A formulação segregada de Peaceman permite o uso de métodos especializados capazes de explorar as particularidades matemáticas de cada equação do sistema resultante. O acoplamente entre estes dois campos é obtido através do uso de um termo de velocidade total.

De modo a utilizar as equações apresentadas ao longo deste capítulo, faz-se necessário a adoção de algumas hipóteses simplificadoras \citep{Carvalho2005,Peaceman1977}:
\begin{itemize}
\item Meio poroso totalmente saturado;
\item Rochas e fluidos incompressíveis;
\item Fluidos imiscíveis;
\item Escoamento isotérmico;
\item Lei de Darcy válida para as velocidades consideradas.
\end{itemize}

Para o correto entendimento da formulação utilizada, faz-se necessário introduzir alguns conceitos, os quais serão discutidos na seção seguinte, usados para a descrição macroscópica das propriedades de rochas, fluidos e da interação entre os mesmos.

\section{Propriedades} \label{sc:propriedades}
Antes de iniciar a descrição das diversas propriedades necessárias para a elaboração do modelo matemático utilizado, é importante fazer um comentário a respeito do modo como essas propriedades se apresentam na realidade e como são de fato representadas na simulação do fenômeno no domínio de interesse.

Para uma perfeita descrição do escoamento de fluidos em meios porosos, seria necessário adotar uma abordagem microscópica, a qual necessitaria do conhecimento das características geométricas de cada um dos poros para a definição das fronteiras e das condições de contorno. De posse dessas informações, seria possível utilizar uma formulação matemática, como as equações de Navier-Stokes \citep{Fortuna2000}, para simular o escoamento de cada um dos fluidos existentes no meio e a interação entre eles. Desnecessário comentar que tal alternativa é impraticável tanto do ponto de vista computacional, já que seria possível analisar domínios apenas em escalas cuja ordem de grandeza esteja na escala dos poros, quanto do ponto de vista da aquisição de dados de entrada, pois é impossível atualmente se obter toda a descrição morfológica de um meio como um reservatório de petróleo, do qual se obtém normalmente apenas algumas amostras, chamadas de testemunhas, as quais são retiradas de pontos que estão várias centenas de metros ou até quilômetros de distância entre si \citep{Thomas2001}.

Sendo assim, para todos os efeitos práticos se utiliza na análise numérica de reservatórios de petróleo uma abordagem macroscópica, onde o valor das propriedades são consideradas variáveis contínuas definidas em todo o domínio ocupado pelo meio poroso. Tais valores das grandezas físicas representam para cada ponto específico uma média volumétrica dos valores da região circunvizinha a este ponto. Ou seja, não é mais necessário uma descrição da morfologia exata do reservatório, já que ao invés disso serão utilizadas propriedades não mensuráveis no nível microscópico, mas que representam no nível macroscópico o efeito equivalente ao da estrutura do meio poroso \citep{Hurtado2005}.

Entretanto, é válido comentar que esta descrição macroscópica do meio poroso apresenta também dificuldades. As formações rochosas que formam os reservatórios de petróleo são frequentemente descritas através de modelos geológicos na escala de metros \citep{Aarnes2007}. Tal escala tornaria em muitos casos inviável a simulação de escoamentos de fluidos em tais reservatórios, já que os mesmos têm ordem de grandeza de quilômetros, o que implicaria para casos tridimensionais em malhas com vários milhões de células, passíveis de serem analisadas apenas em clusters de grande porte.

Apesar do grande aumento percebido na capacidade computacional do hardware utilizado e também do uso de técnicas avançadas para extrair o máximo de desempenho de tais computadores, os modelos de reservatório a serem analisados na prática frequentemente tem que contar com o uso de técnicas de \emph{Upscaling} \citep{Menezes2009}, ou seja, uma restrição dos parâmetros geofísicos obtidos em modelos geológicos para malhas tipicamente dezenas ou centenas de vezes mais grosseiras que serão então analisadas via algum método numérico \citep{Aarnes2007}.

\subsection{Porosidade}
Uma rocha, para ter a capacidade de armazenar petróleo, deve possuir vazios no seu interior, os quais são chamados de poros. Além disso, para que haja fluxo dentro desta rocha-reservatório é necessário que tal poros estejam interconectados para que existam um caminho que os fluidos possam percorrer. Para efeitos de cálculo de porosidade, existe uma diferença entre a porosidade \emph{absoluta}, a qual abrange todos os poros, estejam eles interconectados ou não, e a porosidade \emph{efetiva}, onde apenas os poros ligados entre si são considerados. Apenas esse segundo tipo de porosidade será usado neste trabalho, já que é o de maior interesse para a análise de escoamentos. Portanto, sempre que houver referência à porosidade, pode-se entender como a variante efetiva da mesma.
% Adicionar figura baseada na figura do chines para a porosidade (ou copiar e citar figura da tese do demetrio). Ou entao figura preparado por mim no powerpoint.

A porosidade de uma rocha-reservatório é definida matematicamente como a razão entre o volume dos espaços vazios existentes entre os poros da rocha e o volume total da amostra \citep{Thomas2001}. Logo, podemos descrever a porosidade $\phi$%
\nomenclature[ap]{$\phi$}{Porosidade efetiva}
como:

\begin{equation} \label{eq:porosidade}
\phi = \frac{V_{p}}{V_{t}}
\end{equation}%
\nomenclature[av]{$V$}{Volume}%

onde o volume total é $V_{t} = V_{p} + V_{s}$, $V_{p}$ é o volume poroso e $V_{s}$ o volume da matriz sólida. Segundo a abordagem macroscópica adotada, a porosidade será uma função contínua no espaço. Logo, se está assumindo que o valor calculado pela Eq. (\ref{eq:porosidade}) representará a média de um volume representativo com dimensão pequena quando comparada ao meio poroso como um todo, porém grande em comparação com as dimensões características dos poros.

As Fig. (\ref{fig:meioporoso}) apresenta esquematicamente uma amostra de meio poroso, com uma aproximação em uma parte da mesma onde se pode observar claramente os conceitos de volume poroso e de matriz sólida representados. A caracterização das fases em um escoamento bifásico é vista na Fig. (\ref{fig:meioporososat).

\begin{figure} 
\centering
\includegraphics[width=0.8\textwidth]{chapters/ch02/MeioPoroso}
\caption{Exemplo de meio poroso com destaque para os volumes de matriz sólida (rocha) e de poros (vazio).}
\label{fig:meioporoso}
\end{figure}

\begin{figure} 
\centering
\includegraphics[width=0.8\textwidth]{chapters/ch02/MeioPorosoSaturado}
\caption{Exemplo de meio poroso saturado com escoamento bifásico.}
\label{fig:meioporososat}
\end{figure}

\subsection{Permeabilidade Absoluta}
A permeabilidade absoluta é definida como uma medida da capacidade de um meio poroso de escoar uma única fase sob certas condições. Esta é uma propriedade mais difícil de ser medida do que a porosidade, porém mais importante no que tange ao escoamento de fluidos. Não necessariamente irá existir uma proporcionalidade direta entre estes dois parâmetros, já que para a permeabilidade importa não apenas a quantidade de poros interconectados, mas também o modo como eles estão conectados e a tortuosidade do caminho formado por eles. Existe também a possibilidade de se ter rochas com baixíssimas porosidades, como muitas vezes é o caso de algumas rochas carbonáticas, que porém apresentam uma alta permeabilidade devido à presença de fraturas ou falhas. Todavia, para vários casos específicos podem ser geradas correlações entre as duas propriedades, como pode ser visto na Fig. (\ref{fig:poropermcorrelation}) \citep{Schneider2003}.

Normalmente a permeabilidade é representada matematicamente através de um tensor, denominado de $\mathbi{K}$%
\nomenclature[cp]{$\mathbi{K}$}{Permeabilidade absoluta}
ao longo deste trabalho. Isto significa que não apenas os valores da permeabilidade absoluta variam de acordo com a orientação da rocha, como também que, devido aos termos cruzados de um tensor cheio, os valores em uma direção influenciam a permeabilidade nas outras direções. Neste caso o tensor é chamado de anisotrópico. Se $\mathbi{K}$ puder ser representado por uma função escalar, ou seja, a permeabilidade em todas as direções for a mesma, este tensor degenerado em um escalar é chamado de isotrópico. Além disso, devido a grande heterogeneidade entre as diferentes formações rochosas, a permeabilidade pode variar espacialmente em ordens de grandeza, sendo que variações locais no intervalo entre 1mD e 10D não são incomuns \citep{Aarnes2007}.

O sistema elaborado neste trabalho pode lidar de modo efetivo tanto com tensores cheios (anisotropia), quanto com variações do mesmo ao longo do domínio (heterogeneidade).

\begin{figure} 
\centering
\includegraphics[width=0.6\textwidth, angle=270]{chapters/ch02/PorosityPermModel}
\caption{Exemplo de correlação entre porosidade e permeabilidade absoluta (retirado de \cite{Schneider2003}).}
\label{fig:poropermcorrelation}
\end{figure}

\subsection{Permeabilidade Relativa}
Apesar de termos assumido total imiscibilidade entre as fases é considerado para efeitos de simulação, segundo a abordagem macroscópica adotada neste trabalho, a presença de todas as fases simultaneamente no mesmo ponto, já que como mencionado anteriormente na seção \ref{sc:propriedades} o comportamento do escoamento na escala dos poros não é de interesse prático para a análise de reservatórios. Isto significa que todas as fases terão influência umas sobre as outras.

Portanto, a permeabilidade de fato percebida por um fluido em um meio poroso será reduzida pela pela presença das outras fases, resultando portanto na necessidade da definição de um termo de permeabilidade relativa, representado neste trabalho por $k_{r\alpha}$, que irá descrever como uma fase $\alpha$%
\nomenclature[da]{$\alpha$}{Relativo à fase $\alpha$ ($\alpha$=$w$ para água e $\alpha$=$o$ para óleo)}
escoa na presença simultânea de outras.
As permeabilidades absoluta $\mathbi{K}$, efetiva $\mathbi{K}_{\alpha}$ e relativa $k_{r\alpha}$%
\nomenclature[ak]{$k_{r}$}{Permeabilidade relativa}
estão relacionadas através da seguinte expressão:
\begin{equation} \label{eq:relat_perm}
k_{r\alpha} = \frac{K_{\alpha}}{K} \leq 1
\end{equation}

Dada a complexidade envolvida na interação entre a rocha e as diferentes fases na escala dos poros durante o escoamento, os valores para a permeabilidade relativa em função das propriedades dos fluidos e dos meios poroses são difíceis de serem obtidos. De um modo geral, depende-se de modelos semi-empíricos para uso em simulações de reservatórios de petróleo. Um exemplo típico de curva de permeabilidade relativa tanto da fase água quanto da fase óleo em função da saturação da água usando o modelo de Corey é apresentado na Fig. (\ref{fig:relat_perm}).

\begin{figure} 
\centering
\includegraphics[width=0.6\textwidth]{chapters/ch02/relat_perm}
\caption{Exemplo de modelo de permeabilidade relativa para escoamentos bifásicos em meios porosos.}
\label{fig:relat_perm}
\end{figure}

% +-ok [3] Cite models for relative permeability (Chen,Aziz as general, Brooks-Corey as specific)
\section{Equação da Conservação de Massa}

Considerando a hipótese de meio poroso totalmente saturado e a existência de $n$ fases, a equação constitutiva para a saturação pode ser descrita por:
\begin{equation} \label{eq:eq_const_sat}
\sum_{\alpha=1}^n S_{\alpha} = 1
\end{equation}

Onde $\alpha$ representa cada fase (neste trabalho, $\alpha = w$ e $o$ para água e óleo, respectivamente) e $S_{\alpha}$ representa a saturação da fase ${\alpha}$.
% [2] Describe concepts as effective porosity and volume, and then give definition of saturation in the thesis. 

A lei de Darcy generalizada para a velocidade de cada fase é expressa através da seguinte equação:
\begin{equation} \label{eq:eq_darcy_general}
\mathbi{v}_{\alpha} = - \frac{K_{\alpha}}{\mu_{\alpha}} \nabla\left(p_{\alpha} - \rho_{\alpha}g\nabla z \right)
\end{equation}%
\nomenclature[bv]{$\mathbi{v}$}{Velocidade}%
com $K_{\alpha}$, $\mu_{\alpha}$, $p_{\alpha}$ e $\rho_{\alpha}$ representando a permeabilidade efetiva, viscosidade, pressão e densidade da fase $\alpha$, ao passo que $g$ e $z$ representam a aceleração da gravidade e o deslocamento na direção da mesma, respectivamente.
% [4] Explain better Darcies experiment and how it led to the Darcy's law. Explain also its limitation and how it has been used nowadays far beyond its original intent.

A equação de conservação para cada fase é descrita como em \cite{Peaceman1977}:
\begin{equation} \label{eq:cons_eq}
-\nabla \cdot \left(\rho_{\alpha} \vec{v}_{\alpha}\right) + q_{\alpha} =
\frac{\partial \left(\phi \rho_{\alpha} S_{\alpha}\right)}{\partial t} 
\end{equation}

Os termos $q_{\alpha}$, $\phi$ e $t$ representam termos fontes/sumidores da fase $\alpha$ (por exemplo, poços), porosidade efetiva da rocha e o tempo, respectivamente. Além disso, se forem consideradas duas fases, uma molhante (água) e uma não-molhante (óleo), combinando as Eqs. (\ref{eq:eq_darcy_general}) e (\ref{eq:cons_eq}), e usando a definição dada na Eq. (\ref{eq:relat_perm}), é obtido o seguinte sistema de equações diferenciais parciais que resolve o problem do escoamento bifásico dadas as hipóteses já mencionadas:
\begin{subequations} \label{eq:twophase_system}
  \begin{equation} \label{eq:twophase_systema}
\nabla \cdot \left(\frac{\rho_{w}Kk_{rw}}{\mu_{w}} \nabla\left(p_{w} - \rho_{w}g\nabla z \right)\right) + q_{w} =
\frac{\partial \left(\phi \rho_{w} S_{w}\right)}{\partial t} 
  \end{equation}
  \begin{equation} \label{eq:twophase_systemb}
\nabla \cdot \left(\frac{\rho_{o}Kk_{ro}}{\mu_{o}} \nabla\left(p_{o} - \rho_{o}g\nabla z \right)\right) + q_{o} =
\frac{\partial \left(\phi \rho_{o} S_{o}\right)}{\partial t} 
  \end{equation}
\end{subequations}
% [5] Stress that these equations are more general then the ones necessary for our assumptions and that they will be simplified

Nas Eqs. (\ref{eq:twophase_systema}) e (\ref{eq:twophase_systemb}), os campos de pressão e saturação são acoplados em ambas as equações. As mesmas se assemelham à equação de condução de calor e por isso espera-se que tenham um comportamento essencialmente parabólico. Esta assertiva não é necessariamente verdadeira e pode ser avaliada através da obtenção de um par de equações que seja dependente ou da pressão ou da saturação. A derivação de tais equações é apresentada na seção seguinte.

\section{Equação de Pressão} \label{sc:press_eq}
A abordagem utilizada para se obter a equação de pressão é eliminar a derivada temporal da saturação presenta na Eq. (\ref{eq:twophase_system}). Primeiramente, as derivadas temporais são expandidas para se obter:
\begin{subequations} \label{eq:twophase_system2}
  \begin{equation} \label{eq:twophase_system2a}
-\nabla \cdot \left(\rho_{w} \vec{v}_{w}\right) + q_{w} =
\rho_{w}S_{w}\frac{\partial \phi}{\partial t} + \phi S_{w} \frac{d\rho_{w}}{d p_{w}} \frac{\partial p_{w}}{\partial t} + \phi\rho_{w}\frac{\partial S_{w}}{\partial t}
  \end{equation}
  \begin{equation} \label{eq:twophase_system2b}
-\nabla \cdot \left(\rho_{o} \vec{v}_{o}\right) + q_{o} =
\rho_{o}S_{o}\frac{\partial \phi}{\partial t} + \phi S_{o} \frac{d\rho_{o}}{d p_{o}} \frac{\partial p_{o}}{\partial t} + \phi\rho_{o}\frac{\partial S_{o}}{\partial t}
  \end{equation}
\end{subequations}

Então, dividindo a primeira equação por $\rho_{w}$ e a segunda por $\rho_{o}$, levando em consideração as hipóteses feitas anteriormente de que fluidos e rochas são incompressíveis e finalmente adicionando as equações resultantes, obtêm-se:
% [6] This step mentioned in the previous paragraph can be explained in more 'substeps' in the thesis for clarity
\begin{equation} \label{eq:twophase_oneequation}
-\nabla \cdot \vec{v}_{t} + Q_{t} = \phi \frac{\partial \left(S_{w} + S_{o}\right)}{\partial t}
\end{equation}
where $\vec{v}_{t} = \vec{v}_{w} + \vec{v}_{o}$ is the total velocity of the fluid and $Q_{t} = (q_{w}/\rho_{w}) + (q_{o}/\rho_{o})$ is the total volumetric rate. Moreover, considering Eq. (\ref{eq:eq_const_sat}) and rearranging the terms, we obtain the pressure equation for the two-phase flow in porous media:
\begin{equation} \label{eq:pressure_eq_form1}
\nabla \cdot \vec{v}_{t} = Q_{t}
\end{equation}

De modo a apresentar a Eq. (\ref{eq:pressure_eq_form1}) em relação a apenas uma única variável de pressão, pode-se definir uma pressão média por:
\begin{equation} \label{eq:average_press}
p_{avg} = \frac{p_{w} + p_{o}} {2}
\end{equation}

Considerando a definição de pressão capilar como $p_{c} = p_{o} - p_{w}$, pode-se expressão as pressões das fases individuais como:
% [7] The capillary pressure must be better explained in the thesis, including some classical models for it
\begin{subequations} \label{eq:phase_pressures_cap}
  \begin{equation} \label{eq:phase_pressures_capa}
p_{w} = p_{avg} - \frac{p_{c}}{2}
  \end{equation}
  \begin{equation} \label{eq:phase_pressures_capb}
p_{o} = p_{avg} + \frac{p_{c}}{2}
  \end{equation}
\end{subequations}

As mobilidades das fases são definidas como a relação entre a permeabilidade relatica e a viscosidade do fluido:
\begin{equation} \label{eq:phase_mob}
\lambda_{\alpha} = \frac{k_{r\alpha}}{\mu_{\alpha}}
\end{equation}

Finalmente, reescrevendo a Eq. (\ref{eq:pressure_eq_form1}) utilizando pressões médias e capilares pode-se obter depois de um rearranjo dos termos a seguinte expressão:
\begin{equation} \label{eq:pressure_eq_form2}
\nabla \cdot \left(-K \left( \left(\lambda_{w} + \lambda{o} \right)\nabla p_{avg} + \frac{\lambda_{w} - \lambda_{o}}{2}\nabla p_{c} - 
\left(\lambda_{w}\rho_{w} + \lambda_{o}\rho_{o} \right)g\nabla z \right) \right) = Q_{t}
\end{equation}

Logo, pode ser claramente observado que a Eq. (\ref{eq:pressure_eq_form2}), considerando as hipóteses feitas, tem uma natureza elíptica. A equação de saturação pode ser deduzida usando uma manipulação algébrica similar para completar o modelo acoplado de pressão-saturação para um escoamento bifásico água-óleo em meios porosos. O capítulo \ref{ch:form_num} apresenta métodos para resolver de forma aproximada este tipo de equação.

\section{Equação de Saturação}
\label{sc:eq_sat}
Calculando a velocidade a partir do grandiente de pressão obtido no passo anterior, podemos então definir de modo explícito uma equação para a saturação.
\begin{equation} \label{eq:sat}
\phi \frac{\partial S}{\partial t} + f_{,S} \mathbf{u} \cdot \nabla S + \nabla \cdot 
(\mathbf{\kappa}\lambda_{o}f(\rho_{w} - \rho_{o})\mathbf{g})=0
\end{equation}
a partir de (\ref{eq:sat}) podemos derivar...

\section{Sistema de Equações para Escoamento Bifásico}

